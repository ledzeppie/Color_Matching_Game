<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è°ƒè‰²æ¸¸æˆ</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  html, body {
    height: 100%;
    margin: 0;
    overflow: hidden; /* é¡µé¢ä¸æ»šåŠ¨ */
  }
  .color-swatch {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: inline-block;
    margin-right: 8px;
    border: 1px solid #aaa;
  }
  .color-box {
    width: 80px;
    height: 80px;
    border: 1px solid #ccc;
    margin-right: 12px;
  }
</style>
</head>
<body class="bg-gray-100 p-4 flex flex-col h-full">

<h1 class="text-2xl font-bold mb-2">ğŸ¨ æ²¹ç”»è°ƒè‰²æ¸¸æˆ</h1>

<div class="flex flex-1 gap-6 h-[calc(100%-64px)]">
  <!-- å·¦ä¾§ï¼šç”»ä½œ -->
  <div class="flex flex-col w-2/3 border">
    <label class="block mb-2 font-semibold">é€‰æ‹©ç”»ä½œï¼š</label>
    <select id="artworkSelect" class="border p-2 mb-2 w-full">
      <option value="Irises.jpg">Irises</option>
      <option value="The_Kiss.jpg">The Kiss</option>
      <option value="The_Red_Boy.jpg">The Red Boy</option>
      <option value="Water_Lilies.jpg">Water Lilies</option>
    </select>

    <!-- é™é«˜å®¹å™¨ -->
    <div class="flex-1 flex justify-center items-center overflow-hidden">
      <img id="artworkImage" src="Irises.jpg" class="h-full object-contain cursor-crosshair">
    </div>

    <p class="mt-1 text-gray-600">ç‚¹å‡»å›¾ç‰‡å–ç›®æ ‡é¢œè‰²</p>
  </div>

  <!-- å³ä¾§ï¼šè°ƒè‰²åŒº -->
  <div class="flex flex-col w-1/3 overflow-hidden">
    <h2 class="text-xl font-semibold mb-2">è°ƒè‰²åŒº</h2>

    <!-- ç›®æ ‡è‰² & å½“å‰æ··åˆè‰² -->
    <div class="flex mb-4">
      <div>
        <p class="font-medium">ç›®æ ‡è‰²</p>
        <div id="targetColorBox" class="color-box"></div>
      </div>
      <div>
        <p class="font-medium">å½“å‰æ··åˆè‰²</p>
        <div id="mixedColorBox" class="color-box"></div>
      </div>
      <div class="ml-4">
        <p class="font-medium">åŒ¹é…åº¦</p>
        <div id="matchPercent" class="text-lg font-bold text-blue-600">0%</div>
      </div>
    </div>

    <!-- æ»‘å—åŒºåŸŸ -->
    <div id="sliders" class="flex-1 overflow-auto pr-2"></div>

    <button id="resetBtn" class="mt-2 p-2 bg-blue-500 text-white rounded hover:bg-blue-600">é‡ç½®æ»‘å—</button>
  </div>
</div>

<script>
const pigments = {
  "ç¿ ç»¿": "#2ecc71",
  "æ©™è‰²": "#e67e22",
  "ç´«ç½—å…°": "#8e44ad",
  "é’›ç™½": "#ecf0f1",
  "é•‰çº¢": "#e74c3c",
  "é•‰é»„": "#f1c40f",
  "ç¾¤é’è“": "#34495e",
  "è±¡ç‰™é»‘": "#2c3e50",
  "é»„åœŸè‰²": "#d2b48c"
};

const slidersDiv = document.getElementById("sliders");
const artworkImage = document.getElementById("artworkImage");
const artworkSelect = document.getElementById("artworkSelect");
const targetColorBox = document.getElementById("targetColorBox");
const mixedColorBox = document.getElementById("mixedColorBox");
const matchPercentDiv = document.getElementById("matchPercent");
const resetBtn = document.getElementById("resetBtn");

let targetColor = [0,0,0];
let sliders = [];

// åˆ›å»ºæ»‘å—
for (let name in pigments) {
  let container = document.createElement("div");
  container.className = "flex items-center mb-2";

  let swatch = document.createElement("span");
  swatch.className = "color-swatch";
  swatch.style.backgroundColor = pigments[name];

  let label = document.createElement("label");
  label.textContent = name;
  label.className = "w-20";

  let slider = document.createElement("input");
  slider.type = "range";
  slider.min = 0;
  slider.max = 100;
  slider.value = 0;
  slider.className = "flex-1 ml-2";
  slider.dataset.color = pigments[name];
  slider.addEventListener("input", updateMix);

  container.appendChild(swatch);
  container.appendChild(label);
  container.appendChild(slider);
  slidersDiv.appendChild(container);

  sliders.push(slider);
}

// åˆ‡æ¢å›¾ç‰‡
artworkSelect.addEventListener("change", () => {
  artworkImage.src = artworkSelect.value;
});

// ç‚¹å‡»å–è‰²
artworkImage.addEventListener("click", (e) => {
  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");
  canvas.width = artworkImage.naturalWidth;
  canvas.height = artworkImage.naturalHeight;
  ctx.drawImage(artworkImage, 0, 0);

  const rect = artworkImage.getBoundingClientRect();
  const x = Math.floor((e.clientX - rect.left) * artworkImage.naturalWidth / rect.width);
  const y = Math.floor((e.clientY - rect.top) * artworkImage.naturalHeight / rect.height);

  const data = ctx.getImageData(x, y, 1, 1).data;
  targetColor = [data[0], data[1], data[2]];
  targetColorBox.style.backgroundColor = `rgb(${targetColor.join(",")})`;
  updateMix();
});

// æ›´æ–°æ··åˆè‰²å’ŒåŒ¹é…åº¦
function updateMix(){
  let r=0,g=0,b=0,total=0;
  sliders.forEach(s=>{
    let val=parseInt(s.value);
    let c=hexToRgb(s.dataset.color);
    r+=c[0]*val; g+=c[1]*val; b+=c[2]*val;
    total+=val;
  });
  if(total>0){ r=Math.round(r/total); g=Math.round(g/total); b=Math.round(b/total);}
  else r=g=b=255;
  mixedColorBox.style.backgroundColor=`rgb(${r},${g},${b})`;

  let diff=Math.sqrt((r-targetColor[0])**2+(g-targetColor[1])**2+(b-targetColor[2])**2);
  let percent=Math.max(0,100-diff/4.5);
  matchPercentDiv.textContent=percent.toFixed(1)+"%";
}

// é‡ç½®æ»‘å—
resetBtn.addEventListener("click",()=>{
  sliders.forEach(s=>s.value=0);
  updateMix();
});

function hexToRgb(hex){
  let bigint=parseInt(hex.slice(1),16);
  return [(bigint>>16)&255,(bigint>>8)&255, bigint&255];
}
</script>
</body>
</html>
